<h2>Liste des agences</h2>

<div *ngIf="error" style="color:red">{{ error }}</div>

<table cellpadding="5" cellspacing="0">
  <thead>
    <tr>
      <th>Nom</th>
      <th>Capacité max</th>
      <th>Actions</th>
    </tr>
  </thead>
  <tbody>
    <tr
      *ngFor="let agence of agences"
      (click)="selectAgence(agence)"
      [class.selected]="agence === selectedAgence"
      style="cursor:pointer"
    >
      <td>{{ agence.nom }}</td>
      <td>{{ agence.capaciteMax }}</td>
      <td>
  <iframe
    *ngIf="agence.adresse"
    width="300"
    height="200"
    style="border:0"
    loading="lazy"
    allowfullscreen
    [src]="getMapUrl(agence.adresse)">
  </iframe>
  <span *ngIf="!agence.adresse">Adresse non disponible</span>
</td>


      <td>
        <button (click)="goToEdit(agence.id); $event.stopPropagation()">Modifier</button>
        <button (click)="deleteAgence(agence.id); $event.stopPropagation()">Supprimer</button>
      </td>
    </tr>
  </tbody>
</table>

<button (click)="goToAdd()" class="add-btn">Ajouter une agence</button>

<div *ngIf="selectedAgence">
  <app-occupation-list [agence]="selectedAgence"></app-occupation-list>

  <!-- Carte Leaflet si coordonnées présentes -->
  <div
    *ngIf="selectedAgence.latitude !== undefined && selectedAgence.longitude !== undefined"
    id="map"
    style="height: 300px; width: 80%; max-width: 900px; margin: 20px auto; border-radius: 8px;"
  ></div>

  <!-- Sinon fallback affichage adresse + lien Google Maps -->
  
</div>
